

// ^FO50,1050^GFA,9240,9240,55,,::::::::::::::::::::::::iG03FF,:::::::::::S07FFhK03FF,R0KF8hI03FF,Q0MFhI03FF,P07NFhH03FF,O01OFChG03FF,O07PFhG03FF,N01QFCh03FF,N07RFh03FF,N0SF8gY03FF,M03SFCgY03FF,M07JFE003LFgY03FF,M0JFEJ0LF8gX03FF,L01JFK03KFCgX03FF,L07IFCL0KFEgX03FF,L0JFM07KFgX03FF,K01IFCM03KF8gW03FF,K01IF8M01KFCgW03FF,K03FFEN01KFEgW03FF,K07FFCO0LFgW03FF,K0IF8O0LFgW03FF,K0IFP07FE7FF8R0IFCL07F8L03F8003FF003FFCQ03FFEK01FFCM0IF,J01FFEP07FE3FFCQ0KFCK0FFCL07FC003FF03JFCO01JFCJ03FFEL01IF,J03FFCP07FF1FFCP03LF8J0FFCL07FC003FF1LF8N07KFJ01IFL03FFE,J03FF8P07FF0FFEP0MFEJ0FFCL07FC003OFEM01LFCJ0IF8K07FFC,J07FFQ03FF0IFO03NF8I0FFCL07FC003PFM07LFEJ07FFCK07FFC,J0IFQ03FF07FFO07NFEI0FFCL07FC003PFCL0NF8I03FFEK0IF8,J0FFEQ03FF03FF8N0PFI0FFCL07FC003PFEK01NFCI01IFJ01IF,I01FFCQ03FF03FF8M01PF800FFCL07FC003PFEK03NFEJ0IF8I03FFE,I01FFCQ07FF01FFCM03PFE00FFCL07FC003QFK07OFJ07FF8I07FFC,I03FF8Q07FF01FFCM07JF01JFE00FFCL07FC003KF87JF8J0JF81JFJ03FFCI0IF8,I03FF8Q07FE00FFEM0JFJ0IF800FFCL07FC003JFI01IFCI01IFC001IF8I01FFE001IF,I03FFR07FE007FEL01IF8J03FEI0FFCL07FC003IF8J07FFEI01FFEJ07FFCI01IF001FFE,I07FER0FFE007FEL03FFEL078I0FFCL07FC003FFEK03FFEI03FFCJ03FFEJ0IF803FFC,I07FER0FFE007FFL03FFCQ0FFCL07FC003FFCL0IFI07FF8J01FFEJ07FFC07FFC,I07FEQ01FFC003FFL07FF8Q0FFCL07FC003FFM07FFI07FFL0IFJ03FFE0IF8,I0FFCQ03FFC003FFL07FFR0FFCL07FC003FFM07FF800FFEL07FFJ01FFE1IF,I0FFCQ03FFC003FFL0FFER0FFCL07FC003FFM03FF800FFCL03FF8I01IF3FFE,I0FFCI07M07FF8001FF8K0FFER0FFCL07FC003FFM01FF800FFCL03FF8J0LFC,I0FFC001FCK01IFI01FF8K0FFCR0FFCL07FC003FFM01FF801FF8L01FF8J07KF8,I0FF8007FFK03IFI01FF8K0FFCR0FFCL07FC003FFN0FFC01FF8L01FF8J03KF,I0FF801IFCJ0IFEI01FF8J01FF8R0FFCL07FC003FFN0FFC01RF8J01JFE,001FF803JF8003IFCJ0FF8J01FF8R0FFCL07FC003FFN0FFC01RFCK0JFE,001FF803QFCJ0FF8J01FF8R0FFCL07FC003FFN07FC01RFCK07IFC,001FF801QF8J0FF8J01FFS0FFCL07FC003FFN07FC01RFCK03IF8,001FF8007PFK0FFCJ01FFS0FFCL07FC003FFN07FC01RFCK03IF,001FF8003OFEK0FFCJ01FFS0FFCL07FC003FFN07FC01RFCK01IF,001FF8001PF8J0FFCJ01FFS0FFCL07FC003FFN07FC01RF8K03IF8,001FF8I07OFCJ0FFCJ01FFS0FFCL07FC003FFN07FC01RF8K07IFC,001FF8I01PFJ0FFCJ01FF8R0FFCL07FC003FFN0FFC01RFL0JFE,001FF8J0PF8I0FFCJ01FF8R0FFCL07FC003FFN0FFC01FFCT01KF,001FF8I01PFEI0FFCJ01FF8R0FFCL07FC003FFN0FFC01FFU03KF,001FF8I03QFI0FF8J01FF8R07FEL07FC003FFN0FFC01FF8T03KF8,001FF8I07JFELF800FF8K0FFCR07FEL07FC003FFM01FF801FF8T07KFC,001FF8I07IF8003JFC00FF8K0FFCR07FEL07FC003FFM01FF801FF8T0IFBFFE,I0FF8I0IFEJ07IF001FF8K0FFER07FFL07FC003FFM03FF800FFCS01IF1IF,I0FF8001IF8K0FFC001FF8K07FFR03FFL07FC003FFM07FFI0FFCM04K03FFE0IF8,I0FFC001IFL07FI01FF8K07FF8Q03FF8K07FC003FFM0IFI0FFEL01FK07FFC07FFC,I0FFC003FFCL01CI01FF8K07FFCQ03FFCK07FC003FFL01IFI07FFL03FEJ0IF803FFC,I0FFC007FF8Q01FFL03FFEL07J01FFCK07FC003FFCK03FFEI07FF8K07FF8I0IF003FFE,I07FC007FFR03FFL01IF8J01FCI01FFEK07FC001FFEK07FFCI03FFCJ01IF8001FFE001IF,I07FE00IFR03FFL01IFCJ03FFJ0IF8J0FFC001IF8I01IFCI03IFJ03IF8003FFEI0IF8,I07FE00FFER07FFM0JF8001IF8I07FFEI07FFC001JFI07IF8I01IFCI0JFI07FFCI07FFC,I07FF00FFER07FEM07JFC7JFEI07IFC03IFCI0KF0KFK0JFC0JFEI0IF8I03FFE,I03FF00FFCR07FEM03PFCI03OFCI0PFEK0PFC001IFJ01IF,I03FF81FFCR0FFEM01PFJ01OFCI07OFCK07OF8001FFEK0IF,I03FF81FFCQ01FFCN0OFEK0OFCI01OF8K03OFI03FFCK0IF8,I01FFC1FF8Q01FFCN07NFCK03NFCJ0OFL01NFCI07FFCK07FFC,I01FFC1FF8Q03FF8N01NFL01NFCJ03MFEM07MF8I0IF8K03FFE,J0FFE1FF8Q03FF8O07LFCM07MFCJ01MF8M03LFEI01IFL01IF,J0IF1FF8Q07FFP01LFN01MFCK03KFEO0LF8I03FFEM0IF8,J07FF1FF8Q0IFQ03JF8O01IF8FFCL07JF8O03JFEJ03FFCM07FF8,J07FF9FF8P01FFER03FF8U07FCM07FF8Q03FFEK037FN01B88,J03FFDFFCP01FFEgQ07FC,J01KFCP07FFCgQ07FC,K0KFCP0IF8gQ07FC,K0KFEO01IFgR07FC,K07JFEO03IFgR07FC,K03KFO07FFEgR07FC,K01KF8N0IFCgR07FC,K01KF8M03IF8gR07FC,L0KFCM0JFgS07FC,L07KFL03IFEgS07FC,L01KF8K0JFCgS07FC,M0KFEJ07JF8gS07FC,M07KFC007KFgT07FC,M03SFCgT07FC,M01SF8gT07FC,N07QFEgU07FC,N01QFCgU07FC,O07PFgV07FC,O01OFCgV07FC,P07MFEgW07FC,Q0MFgX07FC,R0KF8gX07FC,S0IF8gY07FC,hV07FC,:::::::::::,:::::::::::::::::::::::^FS

const express = require('express');
const bodyParser = require('body-parser');
const net = require('net'); // Для отправки данных на принтер
const path = require('path');
const app = express();
const port = 3000;

app.use(bodyParser.json());

// Обработчик GET-запроса для отдачи HTML-страницы
app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'index.html'));
});

// Функция для генерации ZPL-кода
function generateZPL(customer_name, order_number, boxNumber, total_boxes) {
    return `
^XA
^FO50,1050^GFA,9240,9240,55,,::::::::::::::::::::::::iG03FF,:::::::::::S07FFhK03FF,R0KF8hI03FF,Q0MFhI03FF,P07NFhH03FF,O01OFChG03FF,O07PFhG03FF,N01QFCh03FF,N07RFh03FF,N0SF8gY03FF,M03SFCgY03FF,M07JFE003LFgY03FF,M0JFEJ0LF8gX03FF,L01JFK03KFCgX03FF,L07IFCL0KFEgX03FF,L0JFM07KFgX03FF,K01IFCM03KF8gW03FF,K01IF8M01KFCgW03FF,K03FFEN01KFEgW03FF,K07FFCO0LFgW03FF,K0IF8O0LFgW03FF,K0IFP07FE7FF8R0IFCL07F8L03F8003FF003FFCQ03FFEK01FFCM0IF,J01FFEP07FE3FFCQ0KFCK0FFCL07FC003FF03JFCO01JFCJ03FFEL01IF,J03FFCP07FF1FFCP03LF8J0FFCL07FC003FF1LF8N07KFJ01IFL03FFE,J03FF8P07FF0FFEP0MFEJ0FFCL07FC003OFEM01LFCJ0IF8K07FFC,J07FFQ03FF0IFO03NF8I0FFCL07FC003PFM07LFEJ07FFCK07FFC,J0IFQ03FF07FFO07NFEI0FFCL07FC003PFCL0NF8I03FFEK0IF8,J0FFEQ03FF03FF8N0PFI0FFCL07FC003PFEK01NFCI01IFJ01IF,I01FFCQ03FF03FF8M01PF800FFCL07FC003PFEK03NFEJ0IF8I03FFE,I01FFCQ07FF01FFCM03PFE00FFCL07FC003QFK07OFJ07FF8I07FFC,I03FF8Q07FF01FFCM07JF01JFE00FFCL07FC003KF87JF8J0JF81JFJ03FFCI0IF8,I03FF8Q07FE00FFEM0JFJ0IF800FFCL07FC003JFI01IFCI01IFC001IF8I01FFE001IF,I03FFR07FE007FEL01IF8J03FEI0FFCL07FC003IF8J07FFEI01FFEJ07FFCI01IF001FFE,I07FER0FFE007FEL03FFEL078I0FFCL07FC003FFEK03FFEI03FFCJ03FFEJ0IF803FFC,I07FER0FFE007FFL03FFCQ0FFCL07FC003FFCL0IFI07FF8J01FFEJ07FFC07FFC,I07FEQ01FFC003FFL07FF8Q0FFCL07FC003FFM07FFI07FFL0IFJ03FFE0IF8,I0FFCQ03FFC003FFL07FFR0FFCL07FC003FFM07FF800FFEL07FFJ01FFE1IF,I0FFCQ03FFC003FFL0FFER0FFCL07FC003FFM03FF800FFCL03FF8I01IF3FFE,I0FFCI07M07FF8001FF8K0FFER0FFCL07FC003FFM01FF800FFCL03FF8J0LFC,I0FFC001FCK01IFI01FF8K0FFCR0FFCL07FC003FFM01FF801FF8L01FF8J07KF8,I0FF8007FFK03IFI01FF8K0FFCR0FFCL07FC003FFN0FFC01FF8L01FF8J03KF,I0FF801IFCJ0IFEI01FF8J01FF8R0FFCL07FC003FFN0FFC01RF8J01JFE,001FF803JF8003IFCJ0FF8J01FF8R0FFCL07FC003FFN0FFC01RFCK0JFE,001FF803QFCJ0FF8J01FF8R0FFCL07FC003FFN07FC01RFCK07IFC,001FF801QF8J0FF8J01FFS0FFCL07FC003FFN07FC01RFCK03IF8,001FF8007PFK0FFCJ01FFS0FFCL07FC003FFN07FC01RFCK03IF,001FF8003OFEK0FFCJ01FFS0FFCL07FC003FFN07FC01RFCK01IF,001FF8001PF8J0FFCJ01FFS0FFCL07FC003FFN07FC01RF8K03IF8,001FF8I07OFCJ0FFCJ01FFS0FFCL07FC003FFN07FC01RF8K07IFC,001FF8I01PFJ0FFCJ01FF8R0FFCL07FC003FFN0FFC01RFL0JFE,001FF8J0PF8I0FFCJ01FF8R0FFCL07FC003FFN0FFC01FFCT01KF,001FF8I01PFEI0FFCJ01FF8R0FFCL07FC003FFN0FFC01FFU03KF,001FF8I03QFI0FF8J01FF8R07FEL07FC003FFN0FFC01FF8T03KF8,001FF8I07JFELF800FF8K0FFCR07FEL07FC003FFM01FF801FF8T07KFC,001FF8I07IF8003JFC00FF8K0FFCR07FEL07FC003FFM01FF801FF8T0IFBFFE,I0FF8I0IFEJ07IF001FF8K0FFER07FFL07FC003FFM03FF800FFCS01IF1IF,I0FF8001IF8K0FFC001FF8K07FFR03FFL07FC003FFM07FFI0FFCM04K03FFE0IF8,I0FFC001IFL07FI01FF8K07FF8Q03FF8K07FC003FFM0IFI0FFEL01FK07FFC07FFC,I0FFC003FFCL01CI01FF8K07FFCQ03FFCK07FC003FFL01IFI07FFL03FEJ0IF803FFC,I0FFC007FF8Q01FFL03FFEL07J01FFCK07FC003FFCK03FFEI07FF8K07FF8I0IF003FFE,I07FC007FFR03FFL01IF8J01FCI01FFEK07FC001FFEK07FFCI03FFCJ01IF8001FFE001IF,I07FE00IFR03FFL01IFCJ03FFJ0IF8J0FFC001IF8I01IFCI03IFJ03IF8003FFEI0IF8,I07FE00FFER07FFM0JF8001IF8I07FFEI07FFC001JFI07IF8I01IFCI0JFI07FFCI07FFC,I07FF00FFER07FEM07JFC7JFEI07IFC03IFCI0KF0KFK0JFC0JFEI0IF8I03FFE,I03FF00FFCR07FEM03PFCI03OFCI0PFEK0PFC001IFJ01IF,I03FF81FFCR0FFEM01PFJ01OFCI07OFCK07OF8001FFEK0IF,I03FF81FFCQ01FFCN0OFEK0OFCI01OF8K03OFI03FFCK0IF8,I01FFC1FF8Q01FFCN07NFCK03NFCJ0OFL01NFCI07FFCK07FFC,I01FFC1FF8Q03FF8N01NFL01NFCJ03MFEM07MF8I0IF8K03FFE,J0FFE1FF8Q03FF8O07LFCM07MFCJ01MF8M03LFEI01IFL01IF,J0IF1FF8Q07FFP01LFN01MFCK03KFEO0LF8I03FFEM0IF8,J07FF1FF8Q0IFQ03JF8O01IF8FFCL07JF8O03JFEJ03FFCM07FF8,J07FF9FF8P01FFER03FF8U07FCM07FF8Q03FFEK037FN01B88,J03FFDFFCP01FFEgQ07FC,J01KFCP07FFCgQ07FC,K0KFCP0IF8gQ07FC,K0KFEO01IFgR07FC,K07JFEO03IFgR07FC,K03KFO07FFEgR07FC,K01KF8N0IFCgR07FC,K01KF8M03IF8gR07FC,L0KFCM0JFgS07FC,L07KFL03IFEgS07FC,L01KF8K0JFCgS07FC,M0KFEJ07JF8gS07FC,M07KFC007KFgT07FC,M03SFCgT07FC,M01SF8gT07FC,N07QFEgU07FC,N01QFCgU07FC,O07PFgV07FC,O01OFCgV07FC,P07MFEgW07FC,Q0MFgX07FC,R0KF8gX07FC,S0IF8gY07FC,hV07FC,:::::::::::,:::::::::::::::::::::::^FS
^LL1200
^PW1000
^FO680,50^A0R,100,100^FDDelayed delivery^FS
^FO550,50^A0R,90,90^FDName: ${customer_name}^FS
^FO400,50^A0R,90,90^FDOrder: ${order_number}^FS
^FO350,50^A0R,40,40^FD_______________________^FS
^FO150,50^A0R,70,70^FDBox ${boxNumber} from ${total_boxes}^FS
^XZ
    `;
}

// Маршрут для генерации ZPL
app.post('/api/print', (req, res) => {
    const { customer_name, order_number, total_boxes, boxes_in_order, current_box } = req.body;

    let zpl = '';

    if (current_box) {
        zpl += generateZPL(customer_name, order_number, current_box, total_boxes);
    } else {
        for (let i = 1; i <= boxes_in_order; i++) {
            zpl += generateZPL(customer_name, order_number, i, total_boxes);
        }
    }

    res.setHeader('Content-Type', 'text/plain');
    res.send(zpl);
});

// Запуск сервера
app.listen(port, () => {
    console.log(`Server running at http://localhost:${port}`);
});


