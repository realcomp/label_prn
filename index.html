<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Label printing Zebra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 600px;
            margin-top: 50px;
            padding: 30px;
            background: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Label Printing Form</h1>
        <form id="labelForm">
            <div class="mb-3">
                <label for="customer_name" class="form-label">Customer name</label>
                <input type="text" class="form-control" id="customer_name" required>
            </div>
            <div class="mb-3">
                <label for="order_number" class="form-label">Order number</label>
                <input type="text" class="form-control" id="order_number" required>
            </div>
            <div class="mb-3">
                <label for="total_boxes" class="form-label">Total boxes in order</label>
                <input type="number" class="form-control" id="total_boxes" min="1" required>
            </div>
            <div class="mb-3">
                <label for="boxes_in_order" class="form-label">Ready boxes number</label>
                <input type="number" class="form-control" id="boxes_in_order" min="1" required>
            </div>
            <div class="mb-3">
                <label for="current_box" class="form-label">Print ONE (!!) label for box number</label>
                <input type="number" class="form-control" id="current_box" min="1">
            </div>
            <!-- Поля для адреса и порта принтера -->
            <div class="mb-3">
                <label for="printer_host" class="form-label">Printer host IP</label>
                <input type="text" class="form-control" id="printer_host" value="192.168.0.100">
            </div>
            <div class="mb-3">
                <label for="printer_port" class="form-label">Printer port</label>
                <input type="number" class="form-control" id="printer_port" value="9100">
            </div>
            <button type="button" class="btn btn-primary" onclick="generateZPL()">Generate ZPL</button>
            <button type="button" class="btn btn-success" onclick="sendToPrinter()">Direct print</button>
        </form>
        <h3 class="mt-4">Результат ZPL:</h3>
        <pre id="zplOutput" class="border p-3 bg-light" style="height: 200px; overflow-y: auto;"></pre>
    </div>


        <div class="output-container">
            <h3>Result data file:</h3>
            <pre id="zplOutput" class="border p-3 bg-light" style="height: 200px; overflow-y: auto;"></pre>
            <button class="btn btn-secondary" onclick="copyToClipboard()">Copy to clipboard</button>
        </div>
    </div>

    <script>
        // Генерация ZPL и отображение в блоке
        function generateZPL() {
            const formData = {
                customer_name: document.getElementById('customer_name').value,
                order_number: document.getElementById('order_number').value,
                total_boxes: document.getElementById('total_boxes').value,
                boxes_in_order: document.getElementById('boxes_in_order').value,
                boxNumber: document.getElementById('current_box').value
            };

            fetch('/api/print', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('zplOutput').textContent = data.zpl;
            })
            .catch(err => console.error('Error:', err));
        }

        // Отправка ZPL на принтер
        function sendToPrinter() {
            const zpl = document.getElementById('zplOutput').textContent;
            const printer_host = document.getElementById('printer_host').value;
            const printer_port = document.getElementById('printer_port').value;

            fetch('/send-to-printer', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ zpl, printer_host, printer_port })
            })
            .then(response => response.text())
            .then(message => alert(message))
            .catch(err => console.error('Error sending to printer:', err));
        }

        // Копирование результата ZPL
        function copyToClipboard() {
            const zplOutput = document.getElementById('zplOutput');
            navigator.clipboard.writeText(zplOutput.textContent)
                .then(() => alert('ZPL-code copied to clipboard'))
                .catch(err => console.error('Copying error:', err));
        }
    </script>
</body>
</html>